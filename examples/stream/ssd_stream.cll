#define N 40
#define K 16
#define W 3

int->int filter ssd {
  int[] l[W*N];
  int[] r[W*N];
  int row = 0;

  work pop 2*N push N-K-W+1 {
    // N (width) = 40, M (height) = 3
    // W = 1, K = 16
    /* int N, M; */
    /* N = 40; */
    
    for(i from 0 to W) {
      l[row][i] = pop();
    }
    for(i from 0 to W) {
      l[row][i] = pop();
    }

    row = row + 1;
    if(row > W) {
      row = 0;
    }

    //for(int n = K + W/2; n < N - W/2; n++) { // column
    for(n from 17 to 39) {
      int min;
      min = 100000;
      int index;
      index = -1;
      
      //for(int k = 0; k < K; k++) {
      for(k from 0 to 16) {
        int sum;
        sum = 0;
        //for(int i = m - W/2; i <= m + W/2; i++) { // row
        int i;
        i = m - 1;
        while(i <= m + 1) {
          //for(int j = n - W/2; j <= n + W/2; j++) { // column
          int j;
          j = n - 1;
          while(j <= n + 1) {
            if(j - k >= 0) {
              sum = (l[i*N + j] - r[i*N + j-k]) * (l[i*N + j] - r[i*N + j-k]) + sum;
              if(min > sum) {
                  min = sum;
                  index = k;
              }
            }
          }
        }
      }
      push(index);
    }
  }

}

int->int pipeline main {
  add ssd();
}

